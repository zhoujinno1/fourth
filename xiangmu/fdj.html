<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="./css/publice.css" />
    <link rel="stylesheet" type="text/css" href="./css/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="./css/fdj.css" />
</head>

<body>
    <!-- 导航 -->
    <div id="nav">
        <div class="nav_BX">
            <div class="nav_BXleft">
                <ul>
                    <li>
                        <a href="index.html">首页</a>
                        <span>|</span>
                    </li>
                    <li><a href="#">华为官网</a><span>|</span></li>
                    <li><a href="#">荣耀</a><span>|</span></li>
                    <li><a href="#">花粉俱乐部</a><span>|</span></li>
                    <li><a href="#">V码(优购码)</a><span>|</span></li>
                    <li><a href="#">企业购</a><span>|</span></li>
                    <li><a href="#">Select Region</a></li>
                </ul>
            </div>
            <div class="nav_BXright">
                <ul>
                    <li><a href="login.html" class="dl">请登陆</a>&nbsp;&nbsp;<a href="resiter.html">注册</a><span>|</span>
                    </li>
                    <li><a href="#">我的订单</a><span>|</span></li>
                    <li>
                        <a href="#">客户服务<i class="iconfont icon-xiajiantou"></i></a><span>|</span>
                        <div class="kf">
                            <p>帮助中心</p>
                            <p>联系客服</p>
                        </div>
                    </li>
                    <li>
                        <a href="#">网站导航<i class="iconfont icon-xiajiantou"></i></a><span>|</span>
                        <div class="wz">
                            <a href="#">商城首页</a>
                        </div>
                    </li>
                    <li>
                        <a href="#">手机版<i class="iconfont icon-xiajiantou"></i></a>
                        <div class="ewm">
                            <div class="ewm_top">
                                <div class="ewm_topleft">
                                    <img src="./images/02.jpg" />
                                </div>
                                <div>

                                </div>
                            </div>
                            <div class="ewn_centent">
                                <div class="ewn_cententleft">
                                    <img src="images/03.jpg" />
                                </div>
                                <div>

                                </div>
                            </div>
                            <div class="ewm_bottom">
                                <div class="ewm_bottomleft">
                                    <img src="./images/03.jpg" />
                                </div>
                                <div>

                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <a href="shpping.html"><i class="iconfont icon-gouwuche"></i>购物车<span class="shulang">(0)</span></a>
                        <div class="gwc">
                            <div class="dgwc"></div>
                            <p>你的购物车空的,感觉选购吧</p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- logo区 -->
    <div id="logo">
        <div class="logo_BX">
            <div class="logo_BXleft">
                <img src="./images/04.png" />
                <img src="./images/05.png" />
            </div>
            <ul class="logo_BXcentent">
                <li><a href="#">手机</a></li>
                <li><a href="#">笔记本电脑</a></li>
                <li><a href="#">平板&穿戴</a></li>
                <li><a href="#">智能家居</a></li>
                <li><a href="#">配件</a></li>
                <li><a href="#">企业购</a></li>
            </ul>
            <div class="log_BXcententhove">

            </div>
            <div class="logo_BXright">
                <input type="text" value="">
                <a href="#"><i class="iconfont icon-faj pox"></i></a>
                <!--  <div class="logo_BXrightbox"> -->
                <a href="#" class="box1">HUAWEI Mate 30</a>
                <a href="#" class="box2">HUAWEI P30</a>
                <!-- </div> -->

            </div>
        </div>
    </div>

    <div id="jg">

    </div>

    <!--  主体区 -->
    <div id="content">
        <div class="content_BX">
            <div class="content_BXtop">
                <a href="index.html" title="首页">首页</a>
                &nbsp;>&nbsp;
                <a href="#" title="手机">手机</a>
                &nbsp;>&nbsp;
                <a href="#" title="HUAWEI Mate系列">HUAWEI Mate系列</a>
                &nbsp;>&nbsp;
                <span>HUAWEI Mate 20 Pro 麒麟980 AI芯片 超广角徕卡三摄 OLED曲面屏 6GB+128GB 全网通版（馥蕾红）</span>
            </div>
            <div class="content_BXbottom">
                <div id="box">
                    <div id="small">
                        <!--小图区-->
                        <img src="https://res.vmallres.com/pimages//product/6901443281213/428_428_1546486249080mp.png"
                            alt="" id="smallImg" />
                        <div id="mask"></div>
                        <!--遮罩层-->
                    </div>
                    <div id="big">
                        <!--大图区-->
                        <img src="https://res.vmallres.com/pimages//product/6901443281213/800_800_1546486249080mp.png"
                            alt="" id="bigImg" />
                    </div>
                </div>
                <div class="xiangqin">
                    <!--                         <div class="c_tite">
                            <h1>HUAWEI nova 6 5G全网通 8GB+128GB DXOMARK MOBILE 自拍排名第一 麒麟990芯片（普罗旺斯）</h1>
                        </div>
                        <div class="c_huodong">
                            <a>【华为感恩回馈季】①享12期免息+赠保护壳②以旧换新再减100,点击前往>></a>
                        </div>
                        <div class="c_jiage">
                            <label>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</label>
                            <span class="zt">
                                <em>¥</em>
                                3799.00
                            </span>
                        </div>
                        <div class="c_pianma">
                            <label>商品编码</label>
                            <span class="ph">2601010170906</span>
                        </div>
                        <div class="c_tujian">
                            <label class="tj1">推荐</label>
                            <ul class="tjs">
                                <li>HUAWEI nova 5z</li>
                                <li>HUAWEI nova 5 Pro</li>
                                <li>FreeBuds 3耳机</li>
                                <li>Sound X 音箱</li>
                            </ul>
                        </div>
                        <div class="jguc">
                            <span>加入购物车</span>
                        </div> -->
                </div>
            </div>
        </div>
    </div>
</body>
<script src="jquery/jquery.min.js"></script>
<script src="js/cookie.js"></script>
<script>
    var dl = document.getElementsByClassName("dl")[0];
    var cUName = getCookieByName("username");
    //console.log(cUName)
    if (cUName) {
        dl.innerHTML = cUName;
        $("dl").attr('href', '#');
    }




    // bigImgLeft / x = (大图的宽度-大图可视区宽度)/(小图宽度-mask的宽度) = 大图宽度/小图宽度 = 大图可视区宽度 / 小图可视区（mask）宽度
    //鼠标移入小图区，显示mask，显示大图big
    var mask = document.getElementById("mask");
    var small = document.getElementById("small");
    var bigImg = document.getElementById("bigImg");
    var big = document.getElementById("big");
    var box = document.getElementById("box");

    box.onmouseover = function () {
        mask.style.display = "block";
        big.style.display = "block";
    }
    box.onmouseout = function () {
        mask.style.display = "none";
        big.style.display = "none";
    }

    box.onmousemove = function (eve) {
        var e = eve || event;
        //mask跟随移动
        var l = e.clientX - this.offsetLeft - mask.offsetWidth / 2;
        var t = e.clientY - this.offsetTop - mask.offsetHeight / 2;

        var maxL = box.clientWidth - mask.offsetWidth;
        var maxT = box.clientHeight - mask.offsetHeight;

        l = l < 0 ? 0 : (l > maxL ? maxL : l);
        t = t < 0 ? 0 : (t > maxT ? maxT : t);

        mask.style.left = l + "px";
        mask.style.top = t + "px";

        //大图的图片也要跟随移动
        //L/l = left/Left
        //box mask bigImg big
        //L = l * left/Left
        var L = l * (bigImg.clientWidth - big.offsetWidth) / (box.clientWidth - mask.offsetWidth);
        var T = t * (bigImg.clientHeight - big.offsetHeight) / (box.clientHeight - mask.offsetHeight);

        bigImg.style.left = -L + "px";
        bigImg.style.top = -T + "px";

        return false;
    }
    $.ajaxSettings.async = false;
    $.getJSON("goods.json", function (res) {
        var str = parseInt(location.href.split("?")[1])
        if (str > 005) {
            var arr = res[1];
            var a = "";
            $.each(arr, function (index, item) {
                if (item.bid == str) {
                    $("#smallImg").attr('src', item.src);
                    $("#bigImg").attr('src', item.bigsrc);
                    /*  $(".xiangqin") */
                    a += `
                           <div class="c_tite">
                            <a class="gBid">${item.bid}</a>
                            <h1>${item.h1}</h1>
                        </div>
                        <div class="c_huodong">
                            <a>${item.yh}</a>
                        </div>
                        <div class="c_jiage">
                            <label>${item.jgs}</label>
                            <span class="zt">
                                <em>¥</em>
                                ${item.price}
                            </span>
                        </div>
                        <div class="c_pianma">
                            <label>${item.shang}</label>
                            <span class="ph">${item.pianhao}</span>
                        </div>
                        <div class="c_tujian">
                            <label class="tj1">推荐</label>
                            <ul class="tjs">
                                <li>${item.tj1}</li>
                                <li>${item.tj2}</li>
                                <li>${item.tj3}</li>
                                <li>${item.tj4}</li>
                            </ul>
                        </div>
                        <div class="jguc">
                            <span class="j">加入购物车</span>
                        </div>
                           `;
                }
                $(".xiangqin").html(a);
            })
        }
        if (str <= 005) {
            var brr = res[0];
            var b = "";
            $.each(brr, function (i, e) {
                console.log(e)
                if (e.bid == str) {
                    $("#smallImg").attr('src', e.src);
                    $("#bigImg").attr('src', e.bigsrc);
                    b += `
                           <div class="c_tite">
                            <a class="gBid">${e.bid}</a>
                            <h1>${e.h1}</h1>
                        </div>
                        <div class="c_huodong">
                            <a>${e.yh}</a>
                        </div>
                        <div class="c_jiage">
                            <label>${e.jgs}</label>
                            <span class="zt">
                                <em>¥</em>
                                ${e.price}
                            </span>
                        </div>
                        <div class="c_pianma">
                            <label>${e.shang}</label>
                            <span class="ph">${e.pianhao}</span>
                        </div>
                        <div class="c_tujian">
                            <label class="tj1">推荐</label>
                            <ul class="tjs">
                                <li>${e.tj1}</li>
                                <li>${e.tj2}</li>
                                <li>${e.tj3}</li>
                                <li>${e.tj4}</li>
                            </ul>
                        </div>
                        <div class="jguc">
                            <span class="j">加入购物车</span>
                        </div>
                           `;
                }
                $(".xiangqin").html(b);
            })
        }
    });


        //添加购物车
        class AddCart{
        constructor(){
            this.add = $(".j");
            console.log(this.add);
            this.cartGoodsNum = $(".shulang");
            this.userName = getCookieByName("username");
        }
        init(){
            this.addClick();
            this.computedNum();
        }
        addClick(){
            var _this = this;
            this.add.click(function(){
               // console.log(1);
                //本地存储
                //console.log($(this))
                var gBid = $(this).parent().prevAll(".c_tite").find(".gBid").html();
                console.log(gBid);
                //console.log(gBid);
                var data = [{
                    bid:gBid,
                    num:1
                }]
        
                if(localStorage.getItem(_this.userName + "goods")){
                  
                    var cartGoods = JSON.parse(localStorage.getItem(_this.userName+"goods"));
                    console.log(cartGoods);
                    var isBid = false;

                    $.each(cartGoods,function(index,ele){
                       
                        if(ele.bid === gBid){
                            isBid = true;
                            ele.num++;
                            return false;
                        }
                    })
                    if(!isBid){
                        cartGoods.push({
                            bid:gBid,
                            num:1
                        })
                    }
                    //设置当前goods
                    localStorage.setItem(_this.userName+"goods",JSON.stringify(cartGoods));
                }else{
                    localStorage.setItem(_this.userName+"goods",JSON.stringify(data));
                }
                _this.computedNum();
            })
        }
        computedNum(){
            var num = 0;
            if(localStorage.getItem(this.userName+"goods")){
                var cGoods = JSON.parse(localStorage.getItem(this.userName+"goods"));
                $.each(cGoods,function(index,ele){
                   // console.log(ele);
                    num = num+parseInt(ele.num);
                });
                this.cartGoodsNum.html(num);
                return num;
            }
        }
    }
  new AddCart().init()
</script>
</html>